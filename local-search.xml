<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>FFMpeg命令分类</title>
    <link href="/2021/06/04/article2/"/>
    <url>/2021/06/04/article2/</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>根据FFmpeg命令的功能分成八大类，详细的使用可以参照《FFmpeg从入门到精通这本书》</p><blockquote><p><img src="https://img-blog.csdnimg.cn/20210603225216334.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></blockquote><h2 id="1-信息查询命令"><a href="#1-信息查询命令" class="headerlink" title="1.信息查询命令"></a>1.信息查询命令</h2><blockquote><p><img src="https://img-blog.csdnimg.cn/20210603225327708.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></blockquote><h2 id="2-录制命令"><a href="#2-录制命令" class="headerlink" title="2.录制命令"></a>2.录制命令</h2><blockquote><p>参数说明<br>-f 设备驱动<br>-i 设备编号</p><h4 id="采集摄像头："><a href="#采集摄像头：" class="headerlink" title="采集摄像头："></a>采集摄像头：</h4><p>ffmpeg -f video4linux2 -i /dev/video0 out.yuv<br>根据采集过程中终端中的提示信息按照规定的格式播放。<br>我的摄像头默认是640x480，25帧，像素格式是yuyv422，使用ffplay播放需要设定正确的参数</p><h4 id="采集桌面："><a href="#采集桌面：" class="headerlink" title="采集桌面："></a>采集桌面：</h4><p>ffmpeg -f x11grab -framerate 25 -video_size 1920x1080 -i :0.0 out.mp4</p><h4 id="采集音频-ffmpeg-f-alsa-i-hw-0-out-wav"><a href="#采集音频-ffmpeg-f-alsa-i-hw-0-out-wav" class="headerlink" title="采集音频 ffmpeg -f alsa -i hw:0 out.wav"></a>采集音频 ffmpeg -f alsa -i hw:0 out.wav</h4></blockquote><h2 id="3-分解与复用命令"><a href="#3-分解与复用命令" class="headerlink" title="3.分解与复用命令"></a>3.分解与复用命令</h2><blockquote><p>ffmpeg -i in.mp4 -vcodec copy -acodec copy out.flv<br>-an 不要音频数据<br>-vn 不要视频数据</p></blockquote><h2 id="4-处理原始数据命令"><a href="#4-处理原始数据命令" class="headerlink" title="4.处理原始数据命令"></a>4.处理原始数据命令</h2><blockquote><h4 id="提取yuv数据：-ffmpeg-i-input-mp4-an-c-v-rawvideo-pix-fmt-yuv420p-out-yuv"><a href="#提取yuv数据：-ffmpeg-i-input-mp4-an-c-v-rawvideo-pix-fmt-yuv420p-out-yuv" class="headerlink" title="提取yuv数据： ffmpeg -i input.mp4 -an -c:v rawvideo -pix_fmt yuv420p out.yuv"></a>提取yuv数据： ffmpeg -i input.mp4 -an -c:v rawvideo -pix_fmt yuv420p out.yuv</h4><p>-c:v 对视频编码，用原始视频进行编码</p><h4 id="提取PCM数据：-ffmpeg-i-input-mp4-vn-ar-44100-ac2-f-s16le-out-pcm"><a href="#提取PCM数据：-ffmpeg-i-input-mp4-vn-ar-44100-ac2-f-s16le-out-pcm" class="headerlink" title="提取PCM数据： ffmpeg -i input.mp4 -vn -ar 44100 -ac2 -f s16le out.pcm"></a>提取PCM数据： ffmpeg -i input.mp4 -vn -ar 44100 -ac2 -f s16le out.pcm</h4><p>-ar 音频采样率<br>-ac 声道数<br>-f 数据存储方式</p></blockquote><h2 id="5-滤镜命令"><a href="#5-滤镜命令" class="headerlink" title="5.滤镜命令"></a>5.滤镜命令</h2><blockquote><h4 id="视频尺寸修改滤镜-ffmpeg-i-in-mp4-vf-crop-in-w-200-in-h-200-c-v-libx264-c-a-copy-out-mp4"><a href="#视频尺寸修改滤镜-ffmpeg-i-in-mp4-vf-crop-in-w-200-in-h-200-c-v-libx264-c-a-copy-out-mp4" class="headerlink" title="视频尺寸修改滤镜 ffmpeg -i in.mp4 -vf crop=in_w-200:in_h-200 -c:v libx264 -c:a copy out.mp4"></a>视频尺寸修改滤镜 ffmpeg -i in.mp4 -vf crop=in_w-200:in_h-200 -c:v libx264 -c:a copy out.mp4</h4></blockquote><h2 id="6-裁剪与合并"><a href="#6-裁剪与合并" class="headerlink" title="6.裁剪与合并"></a>6.裁剪与合并</h2><blockquote><h4 id="裁剪-ffmpeg-i-in-mp4-ss-00-00-00-t-10-out-mp4"><a href="#裁剪-ffmpeg-i-in-mp4-ss-00-00-00-t-10-out-mp4" class="headerlink" title="裁剪 ffmpeg -i in.mp4 -ss 00:00:00 -t 10 out.mp4"></a>裁剪 ffmpeg -i in.mp4 -ss 00:00:00 -t 10 out.mp4</h4><p>-ss 裁剪起始时间<br>-t   裁剪时长</p><h4 id="合并-ffmpeg-f-concat-i-inputs-txt-out-flv"><a href="#合并-ffmpeg-f-concat-i-inputs-txt-out-flv" class="headerlink" title="合并 ffmpeg -f concat -i inputs.txt out.flv"></a>合并 ffmpeg -f concat -i inputs.txt out.flv</h4><p>-f concat 对后面的文件进行拼接 inputs.txt 内容为 ‘file filename’格式</p><p> file内容如下，和裁切片段一个目录下，采用相对路径</p><p><img src="https://img-blog.csdnimg.cn/20210604124948452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></blockquote><h2 id="7-图片与视频命令互转"><a href="#7-图片与视频命令互转" class="headerlink" title="7.图片与视频命令互转"></a>7.图片与视频命令互转</h2><blockquote><h4 id="视频转图片-ffmpeg-i-outlydy2-mp4-r-1-f-image2-image-3d-jpeg"><a href="#视频转图片-ffmpeg-i-outlydy2-mp4-r-1-f-image2-image-3d-jpeg" class="headerlink" title="视频转图片 ffmpeg -i outlydy2.mp4 -r 1 -f image2 image-%3d.jpeg"></a>视频转图片 ffmpeg -i outlydy2.mp4 -r 1 -f image2 image-%3d.jpeg</h4><p>-r 1 1秒钟一张图片<br>-f image2图片格式 <img src="https://img-blog.csdnimg.cn/2021060412573361.png" alt="在这里插入图片描述"></p><h4 id="图片转视频-ffmpeg-i-image-3d-jpeg-out-mp4-ffplay-r-1-hello-mp4"><a href="#图片转视频-ffmpeg-i-image-3d-jpeg-out-mp4-ffplay-r-1-hello-mp4" class="headerlink" title="图片转视频 ffmpeg -i image-%3d.jpeg out.mp4 ffplay -r 1 hello.mp4"></a>图片转视频 ffmpeg -i image-%3d.jpeg out.mp4 ffplay -r 1 hello.mp4</h4></blockquote><h2 id="8-直播推-拉流"><a href="#8-直播推-拉流" class="headerlink" title="8.直播推/拉流"></a>8.直播推/拉流</h2><blockquote><h4 id="推流-ffmpeg-re-i-out-mp4-c-copy-f-flv-rtmp-127-0-0-1-live-livestream"><a href="#推流-ffmpeg-re-i-out-mp4-c-copy-f-flv-rtmp-127-0-0-1-live-livestream" class="headerlink" title="推流 ffmpeg -re -i out.mp4 -c copy -f flv rtmp://127.0.0.1/live/livestream"></a>推流 ffmpeg -re -i out.mp4 -c copy -f flv rtmp://127.0.0.1/live/livestream</h4><p>-re 按时间戳读取文件</p><h4 id="拉流-拉到本地保存成多媒体文件-ffmpeg-i-rtmp-127-0-0-1-live-livestream-c-copy-live-flv"><a href="#拉流-拉到本地保存成多媒体文件-ffmpeg-i-rtmp-127-0-0-1-live-livestream-c-copy-live-flv" class="headerlink" title="拉流 拉到本地保存成多媒体文件 ffmpeg -i  rtmp://127.0.0.1/live/livestream -c copy live.flv"></a>拉流 拉到本地保存成多媒体文件 ffmpeg -i  rtmp://127.0.0.1/live/livestream -c copy live.flv</h4><p>ffplay直接观看 ffplay rtmp://127.0.0.1/live/livestream</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>FFmpeg编译与依赖库安装</title>
    <link href="/2021/06/03/post1/"/>
    <url>/2021/06/03/post1/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>刚开始学音视频开发，环境的配置研究了几天在几个虚拟机上都尝试了一下，终于把刚开始能踩的坑都踩遍了，遇到了各种问题，经过我的收集整理，把所有遇到的问题都放进来，后面再遇到问题还会继续更新的，作为个人以后参考用，如果写的有错误请各位大佬在评论区指正！感谢很多人帮助了我，希望自己也可以帮助更多的人。<br>我是Ubuntu18.04的版本，不知道是不是版本问题，下的版本好多配置和包都没有，手动配置了好久。</p><h1 id="前期准备工作"><a href="#前期准备工作" class="headerlink" title="前期准备工作"></a>前期准备工作</h1><p>省得之后文件权限问题，都是血和泪的教训啊，记不清在哪个错误的目录下 chmod -R -777 结果sudo su打不开了，为了防止和我一样的错误，先设置一下默认进入root用户，及时备份虚拟机。<br>具体的看这篇，很详细了，感谢这位老哥<br><a href="https://blog.csdn.net/qq_39591507/article/details/81288644">https://blog.csdn.net/qq_39591507/article/details/81288644</a><br>以root身份登陆以后打开shell是这样的<br><img src="https://img-blog.csdnimg.cn/20210420150510445.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">下一步，打开根目录下opt文件夹，新建一个lib文件夹，之后编译的库放里面，后面全部编译完成以后把这个文件夹备份一下<br><img src="https://img-blog.csdnimg.cn/20210420150955569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">里面我已经编译好了，下载的库资源全部放这里面。</p><h1 id="安装yasm"><a href="#安装yasm" class="headerlink" title="安装yasm"></a>安装yasm</h1><p>直接在刚刚的lib文件夹下面打开终端<br>wget <a href="http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz">http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz</a><br>tar xvzf yasm-1.3.0.tar.gz<br>cd yasm-1.3.0<br>./configure<br>make &amp;&amp; make install</p><p>PS：//默认的./configure 配置是安装在usr/local/lib里面，后面ffmpeg不放进去，前期的一些必要的组件直接configure没问题。</p><h1 id="安装nasm（2-13以上版本）"><a href="#安装nasm（2-13以上版本）" class="headerlink" title="安装nasm（2.13以上版本）"></a>安装nasm（2.13以上版本）</h1><p>和上面一样<br>wget <a href="https://www.nasm.us/pub/nasm/releasebuilds/2.14.02/nasm-2.14.02.tar.bz2">https://www.nasm.us/pub/nasm/releasebuilds/2.14.02/nasm-2.14.02.tar.bz2</a><br>tar xvf nasm-2.14.02.tar.bz2<br>cd nasm-2.14.02<br>./configure<br>make<br>make install</p><h1 id="安装其他依赖"><a href="#安装其他依赖" class="headerlink" title="安装其他依赖"></a>安装其他依赖</h1><p>apt install cmake -y<br>apt install pkg-config   //后面编译x264和x265需要</p><h1 id="编译x264（只编译静态库）"><a href="#编译x264（只编译静态库）" class="headerlink" title="编译x264（只编译静态库）"></a>编译x264（只编译静态库）</h1><p>x264下载地址：<br><a href="http://ftp.videolan.org/pub/videolan/x264/snapshots/">http://ftp.videolan.org/pub/videolan/x264/snapshots/</a><br>tar xvf x264-snapshot-20191024-2245-stable.tar.bz2<br>cd x264-snapshot-20191024-2245-stable<br>./configure –enable-static –prefix=../x264 –enable-pic<br>make -j<br>make install<br>//make -j4就是开启4个并行编译，make -j不加数字就是默认全部核心数，编译速度差不多要快一半<br>##编译x265（只编译静态库）<br>x265下载地址:<br><a href="http://ftp.videolan.org/pub/videolan/x265/">http://ftp.videolan.org/pub/videolan/x265/</a><br>tar xvf x265_3.2.tar.gz<br>//<strong>和x264编译不一样，264直接在根目录下编译，265要进入这个目录</strong><br>cd x265_3.2/build/linux/        </p><p>cmake -G “Unix Makefiles” -DCMAKE_INSTALL_PREFIX=”../../../x265” -DENABLE_SHARED:bool=off ../../source<br>make -j<br>make install<br>为了避免后面的问题，我们先进行如下的设置<br><img src="https://img-blog.csdnimg.cn/20210420153019777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>进入265这个目录，编辑一下这个文件<br>按如图添加依赖<br><img src="https://img-blog.csdnimg.cn/20210420153143863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="编译SDL2"><a href="#编译SDL2" class="headerlink" title="编译SDL2"></a>编译SDL2</h1><p>编译之前检查一下Ubuntu是否声音输出是否正常，我的是不正常的，基本各种疑难杂症都给我遇见了，不过问题不大，参考一下别人的解决方法。<br><a href="https://blog.csdn.net/multimicro/article/details/82528730">https://blog.csdn.net/multimicro/article/details/82528730</a><br>确保有声音再进入下一步<br>我需要用到ffplay, 需要再下载SDL的源码，<a href="http://libsdl.org/release/">http://libsdl.org/release/</a><br>我的版本是SDL2-2.0.14<br>在编译之前先安装<br>sudo apt-get install libx11-dev<br>sudo apt-get install xorg-dev<br>不然会无法渲染SDL displa<br>如运行ffplay时，有些机器上会出现<br>Could not initialize SDL - No available video device<br>(Did you set the DISPLAY variable?)<br>说明系统中没有安装x11的库文件，因此编译出来的SDL库实际上不能用。</p><p>需要先编译安装SDL，和上面一样，直接默认编译安装</p><p>tar zxvf SDL2-2.0.8.tar.gz</p><p>cd SDL2-2.0.8</p><p>./configure</p><p>make</p><p>make install</p><h1 id="编译ffmpeg"><a href="#编译ffmpeg" class="headerlink" title="编译ffmpeg"></a>编译ffmpeg</h1><p>编译ffmpeg是最后一步，但是前面任何一步配置错误，回去修改以后，ffmpeg都要重新编译。</p><p>ffmpeg直接去官网下载，我下的是4.3.2版本的<br>解压以后还是在lib文件夹里面，我在官网下载的提取出来还套了一个文件夹，直接移到外面来，如图，不然没法直接执行下面的命令<br><img src="https://img-blog.csdnimg.cn/20210420155055789.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">在当前页面打开终端执行<br>export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:../x264/lib/pkgconfig:../x265/lib/pkgconfig</p><p>./configure –enable-shared –enable-nonfree –enable-gpl –enable-pthreads –enable-libx264 –enable-libx265 –prefix=../ffmpeg </p><p>make -j<br>make install</p><p>编译完以后lib文件夹多了这三个</p><p><img src="https://img-blog.csdnimg.cn/20210420165525566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="编译ffmpeg-1"><a href="#编译ffmpeg-1" class="headerlink" title="编译ffmpeg"></a>编译ffmpeg</h1><p>编译完成后，进入/etc/profile中将ffmpeg加入到环境变量（在文件最后加上export PATH=/opt/lib/ffmpeg/bin:$PATH）<br><img src="https://img-blog.csdnimg.cn/20210420163102945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">进一步，把ffmpeg的库加入/etc/ld.so.conf中<br><img src="https://img-blog.csdnimg.cn/20210420163524174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="测试是否安装成功"><a href="#测试是否安装成功" class="headerlink" title="测试是否安装成功"></a>测试是否安装成功</h1><p>执行ffmpeg -devices<br><img src="https://img-blog.csdnimg.cn/20210420160325660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Z2VidWN1bw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">我已经解决了，如果需要alsa驱动的需要装一下alsa驱动</p><p>之前的问题是编译完了ffmpeg发现没有alsa音频驱动，关于如何安装alsa音频驱动建议看这篇<br><a href="https://blog.csdn.net/keepingstudying/article/details/7373246">https://blog.csdn.net/keepingstudying/article/details/7373246</a></p><p>安装完了重启，然后重新编译ffmpeg<br>再测试一下ffplay命令，<br>ffplay xxx.MP4<br>如果可以正常播放视频,声音正常就ok，否则需要重装SDL2，然后重新编译ffmpeg</p><p>主体参考了云天之巅博主的，感谢！<br>具体不清楚的可以看云天之巅博主的视频<br><a href="https://www.bilibili.com/video/BV1Sz411v7Wm">https://www.bilibili.com/video/BV1Sz411v7Wm</a></p><hr>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
